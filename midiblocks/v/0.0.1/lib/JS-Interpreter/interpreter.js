/**
 * @license
 * Copyright 2013 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";var Interpreter=function(e,t){"string"===typeof e&&(e=acorn.parse(e,Interpreter.PARSE_OPTIONS)),this.nodeConstructor=e.constructor;var r=new this.nodeConstructor({options:{}});for(var n in e)r[n]="body"===n?e[n].slice():e[n];this.ast=r,this.initFunc_=t,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);var o,i=/^step([A-Z]\w*)$/;for(var s in this)"function"===typeof this[s]&&(o=s.match(i))&&(this.stepFunctions_[o[1]]=this[s].bind(this));this.globalScope=this.createScope(this.ast,null),this.globalObject=this.globalScope.object,this.ast=acorn.parse(this.polyfills_.join("\n"),Interpreter.PARSE_OPTIONS),this.polyfills_=void 0,Interpreter.stripLocations_(this.ast,void 0,void 0);var a=new Interpreter.State(this.ast,this.globalScope);a.done=!1,this.stateStack=[a],this.run(),this.value=void 0,this.ast=r;a=new Interpreter.State(this.ast,this.globalScope);a.done=!1,this.stateStack.length=0,this.stateStack[0]=a,this["stateStack"]=this.stateStack};Interpreter.Completion={NORMAL:0,BREAK:1,CONTINUE:2,RETURN:3,THROW:4},Interpreter.PARSE_OPTIONS={ecmaVersion:5},Interpreter.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},Interpreter.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},Interpreter.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},Interpreter.STEP_ERROR={STEP_ERROR:!0},Interpreter.SCOPE_REFERENCE={SCOPE_REFERENCE:!0},Interpreter.VALUE_IN_DESCRIPTOR={VALUE_IN_DESCRIPTOR:!0},Interpreter.REGEXP_TIMEOUT={REGEXP_TIMEOUT:!0},Interpreter.toStringCycles_=[],Interpreter.vm=null,Interpreter.WORKER_CODE=["onmessage = function(e) {","var result;","var data = e.data;","switch (data[0]) {","case 'split':","result = data[1].split(data[2], data[3]);","break;","case 'match':","result = data[1].match(data[2]);","break;","case 'search':","result = data[1].search(data[2]);","break;","case 'replace':","result = data[1].replace(data[2], data[3]);","break;","case 'exec':","var regexp = data[1];","regexp.lastIndex = data[2];","result = [regexp.exec(data[3]), data[1].lastIndex];","break;","default:","throw Error('Unknown RegExp operation: ' + data[0]);","}","postMessage(result);","};"],Interpreter.legalArrayLength=function(e){var t=e>>>0;return t===Number(e)?t:NaN},Interpreter.legalArrayIndex=function(e){var t=e>>>0;return String(t)===String(e)&&4294967295!==t?t:NaN},Interpreter.stripLocations_=function(e,t,r){for(var n in t?e["start"]=t:delete e["start"],r?e["end"]=r:delete e["end"],e)if(e.hasOwnProperty(n)){var o=e[n];o&&"object"===typeof o&&Interpreter.stripLocations_(o,t,r)}},Interpreter.prototype["REGEXP_MODE"]=2,Interpreter.prototype["REGEXP_THREAD_TIMEOUT"]=1e3,Interpreter.prototype.getterStep_=!1,Interpreter.prototype.setterStep_=!1,Interpreter.prototype.appendCode=function(e){var t=this.stateStack[0];if(!t||"Program"!==t.node["type"])throw Error("Expecting original AST to start with a Program node.");if("string"===typeof e&&(e=acorn.parse(e,Interpreter.PARSE_OPTIONS)),!e||"Program"!==e["type"])throw Error("Expecting new AST to start with a Program node.");this.populateScope_(e,t.scope),Array.prototype.push.apply(t.node["body"],e["body"]),t.done=!1},Interpreter.prototype.step=function(){var e=this.stateStack;do{var t=e[e.length-1];if(!t)return!1;var r=t.node,n=r["type"];if("Program"===n&&t.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[n](e,t,r)}catch(i){if(i!==Interpreter.STEP_ERROR)throw i}if(o&&e.push(o),this.getterStep_)throw Error("Getter not supported in this context");if(this.setterStep_)throw Error("Setter not supported in this context")}while(!r["end"]);return!0},Interpreter.prototype.run=function(){while(!this.paused_&&this.step());return this.paused_},Interpreter.prototype.initGlobal=function(e){this.setProperty(e,"NaN",NaN,Interpreter.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,Interpreter.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,Interpreter.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,Interpreter.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,Interpreter.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new Interpreter.Object(null),this.FUNCTION_PROTO=new Interpreter.Object(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT,Interpreter.NONENUMERABLE_DESCRIPTOR),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var t=this,r=this.createNativeFunction((function(e){throw EvalError("Can't happen")}),!1);r.eval=!0,this.setProperty(e,"eval",r),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var n=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<n.length;o++){var i=function(e){return function(r){try{return e(r)}catch(n){t.throwException(t.URI_ERROR,n.message)}}}(n[o][0]);this.setProperty(e,n[o][1],this.createNativeFunction(i,!1),Interpreter.NONENUMERABLE_DESCRIPTOR)}this["OBJECT"]=this.OBJECT,this["OBJECT_PROTO"]=this.OBJECT_PROTO,this["FUNCTION"]=this.FUNCTION,this["FUNCTION_PROTO"]=this.FUNCTION_PROTO,this["ARRAY"]=this.ARRAY,this["ARRAY_PROTO"]=this.ARRAY_PROTO,this["REGEXP"]=this.REGEXP,this["REGEXP_PROTO"]=this.REGEXP_PROTO,this["DATE"]=this.DATE,this["DATE_PROTO"]=this.DATE_PROTO,this.initFunc_&&this.initFunc_(this,e)},Interpreter.prototype.initFunction=function(e){var t,r=this,n=/^[A-Za-z_$][\w$]*$/;t=function(e){if(arguments.length)var t=String(arguments[arguments.length-1]);else t="";var o=Array.prototype.slice.call(arguments,0,-1).join(",").trim();if(o){for(var i=o.split(/\s*,\s*/),s=0;s<i.length;s++){var a=i[s];n.test(a)||r.throwException(r.SYNTAX_ERROR,"Invalid function argument: "+a)}o=i.join(", ")}try{var p=acorn.parse("(function("+o+") {"+t+"})",Interpreter.PARSE_OPTIONS)}catch(u){r.throwException(r.SYNTAX_ERROR,"Invalid code: "+u.message)}1!==p["body"].length&&r.throwException(r.SYNTAX_ERROR,"Invalid code in function body.");var c=p["body"][0]["expression"];return r.createFunction(c,r.globalScope)},this.FUNCTION=this.createNativeFunction(t,!0),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO,Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,Interpreter.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR);var o=function(e){if(!(e instanceof Interpreter.Object)&&!r.getScope().strict)if(void 0===e||null===e)e=r.globalObject;else{var t=r.createObjectProto(r.getPrototype(e));t.data=e,e=t}return e};t=function(e,t){var n=r.stateStack[r.stateStack.length-1];n.func_=this,n.funcThis_=o(e),n.arguments_=[],null!==t&&void 0!==t&&(t instanceof Interpreter.Object?n.arguments_=r.arrayPseudoToNative(t):r.throwException(r.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),n.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",t),t=function(e){var t=r.stateStack[r.stateStack.length-1];t.func_=this,t.funcThis_=o(e),t.arguments_=[];for(var n=1;n<arguments.length;n++)t.arguments_.push(arguments[n]);t.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",t),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),t=function(){return String(this)},this.setNativeFunctionPrototype(this.FUNCTION,"toString",t),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",t),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR)},Interpreter.prototype.initObject=function(e){var t,r=this;t=function(e){if(void 0===e||null===e)return r.calledWithNew()?this:r.createObjectProto(r.OBJECT_PROTO);if(!(e instanceof Interpreter.Object)){var t=r.createObjectProto(r.getPrototype(e));return t.data=e,t}return e},this.OBJECT=this.createNativeFunction(t,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO,Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT,Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"Object",this.OBJECT);var n=function(e){void 0!==e&&null!==e||r.throwException(r.TYPE_ERROR,"Cannot convert '"+e+"' to object")};t=function(e){n(e);var t=e instanceof Interpreter.Object?e.properties:e;return r.arrayNativeToPseudo(Object.getOwnPropertyNames(t))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(e){return n(e),e instanceof Interpreter.Object&&(e=e.properties),r.arrayNativeToPseudo(Object.keys(e))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(e){return null===e?r.createObjectProto(null):(e instanceof Interpreter.Object||r.throwException(r.TYPE_ERROR,"Object prototype may only be an Object or null"),r.createObjectProto(e))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),t=function(e,t,n){return t=String(t),e instanceof Interpreter.Object||r.throwException(r.TYPE_ERROR,"Object.defineProperty called on non-object"),n instanceof Interpreter.Object||r.throwException(r.TYPE_ERROR,"Property description must be an object"),!e.properties[t]&&e.preventExtensions&&r.throwException(r.TYPE_ERROR,"Can't define property '"+t+"', object is not extensible"),r.setProperty(e,t,Interpreter.VALUE_IN_DESCRIPTOR,n.properties),e},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),t=function(e,t){if(e instanceof Interpreter.Object||r.throwException(r.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),t=String(t),t in e.properties){var n=Object.getOwnPropertyDescriptor(e.properties,t),o=e.getter[t],i=e.setter[t],s=r.createObjectProto(r.OBJECT_PROTO);return o||i?(r.setProperty(s,"get",o),r.setProperty(s,"set",i)):(r.setProperty(s,"value",n.value),r.setProperty(s,"writable",n.writable)),r.setProperty(s,"configurable",n.configurable),r.setProperty(s,"enumerable",n.enumerable),s}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(e){return n(e),r.getPrototype(e)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(e){return Boolean(e)&&!e.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),t=function(e){return e instanceof Interpreter.Object&&(e.preventExtensions=!0),e},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",Interpreter.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",Interpreter.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",Interpreter.Object.prototype.valueOf),t=function(e){return n(this),this instanceof Interpreter.Object?String(e)in this.properties:this.hasOwnProperty(e)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",t),t=function(e){return n(this),this instanceof Interpreter.Object?Object.prototype.propertyIsEnumerable.call(this.properties,e):this.propertyIsEnumerable(e)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",t),t=function(e){while(1){if(e=r.getPrototype(e),!e)return!1;if(e===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",t)},Interpreter.prototype.initArray=function(e){var t,r=this;t=function(e){if(r.calledWithNew())var t=this;else t=r.createArray();var n=arguments[0];if(1===arguments.length&&"number"===typeof n)isNaN(Interpreter.legalArrayLength(n))&&r.throwException(r.RANGE_ERROR,"Invalid array length"),t.properties.length=n;else{for(var o=0;o<arguments.length;o++)t.properties[o]=arguments[o];t.properties.length=o}return t},this.ARRAY=this.createNativeFunction(t,!0),this.ARRAY_PROTO=this.ARRAY.properties["prototype"],this.setProperty(e,"Array",this.ARRAY),t=function(e){return e&&"Array"===e.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(t,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ARRAY_PROTO,"length",0,{configurable:!1,enumerable:!1,writable:!0}),this.ARRAY_PROTO.class="Array",t=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",t),t=function(e){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",t),t=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",t),t=function(e){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",t),t=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",t),t=function(e,t){var n=Array.prototype.splice.apply(this.properties,arguments);return r.arrayNativeToPseudo(n)},this.setNativeFunctionPrototype(this.ARRAY,"splice",t),t=function(e,t){var n=Array.prototype.slice.call(this.properties,e,t);return r.arrayNativeToPseudo(n)},this.setNativeFunctionPrototype(this.ARRAY,"slice",t),t=function(e){return Array.prototype.join.call(this.properties,e)},this.setNativeFunctionPrototype(this.ARRAY,"join",t),t=function(e){for(var t=[],n=0,o=r.getProperty(this,"length"),i=0;i<o;i++){if(r.hasProperty(this,i)){var s=r.getProperty(this,i);t[n]=s}n++}for(i=0;i<arguments.length;i++){var a=arguments[i];if(r.isa(a,r.ARRAY))for(var p=r.getProperty(a,"length"),c=0;c<p;c++)r.hasProperty(a,c)&&(t[n]=r.getProperty(a,c)),n++;else t[n]=a}return r.arrayNativeToPseudo(t)},this.setNativeFunctionPrototype(this.ARRAY,"concat",t),t=function(e,t){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",t),t=function(e,t){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",t),t=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",t),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},Interpreter.prototype.initString=function(e){var t,r=this;t=function(e){return e=arguments.length?String(e):"",r.calledWithNew()?(this.data=e,this):e},this.STRING=this.createNativeFunction(t,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),Interpreter.NONENUMERABLE_DESCRIPTOR);for(var n=["charAt","charCodeAt","concat","indexOf","lastIndexOf","slice","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim"],o=0;o<n.length;o++)this.setNativeFunctionPrototype(this.STRING,n[o],String.prototype[n[o]]);t=function(e,t,n){return t=t?r.pseudoToNative(t):void 0,n=n?r.pseudoToNative(n):void 0,String(this).localeCompare(e,t,n)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",t),t=function(e,t,n){var o=String(this);if(t=t?Number(t):void 0,r.isa(e,r.REGEXP)&&(e=e.data,r.maybeThrowRegExp(e,n),2===r["REGEXP_MODE"]))if(Interpreter.vm){var i={string:o,separator:e,limit:t},s="string.split(separator, limit)",a=r.vmCall(s,i,e,n);a!==Interpreter.REGEXP_TIMEOUT&&n(r.arrayNativeToPseudo(a))}else{var p=r.createWorker(),c=r.regExpTimeout(e,p,n);p.onmessage=function(e){clearTimeout(c),n(r.arrayNativeToPseudo(e.data))},p.postMessage(["split",o,e,t])}else{a=o.split(e,t);n(r.arrayNativeToPseudo(a))}},this.setAsyncFunctionPrototype(this.STRING,"split",t),t=function(e,t){var n=String(this);if(e=r.isa(e,r.REGEXP)?e.data:new RegExp(e),r.maybeThrowRegExp(e,t),2!==r["REGEXP_MODE"]){s=n.match(e);t(s&&r.arrayNativeToPseudo(s))}else if(Interpreter.vm){var o={string:n,regexp:e},i="string.match(regexp)",s=r.vmCall(i,o,e,t);s!==Interpreter.REGEXP_TIMEOUT&&t(s&&r.arrayNativeToPseudo(s))}else{var a=r.createWorker(),p=r.regExpTimeout(e,a,t);a.onmessage=function(e){clearTimeout(p),t(e.data&&r.arrayNativeToPseudo(e.data))},a.postMessage(["match",n,e])}},this.setAsyncFunctionPrototype(this.STRING,"match",t),t=function(e,t){var n=String(this);if(e=r.isa(e,r.REGEXP)?e.data:new RegExp(e),r.maybeThrowRegExp(e,t),2!==r["REGEXP_MODE"])t(n.search(e));else if(Interpreter.vm){var o={string:n,regexp:e},i="string.search(regexp)",s=r.vmCall(i,o,e,t);s!==Interpreter.REGEXP_TIMEOUT&&t(s)}else{var a=r.createWorker(),p=r.regExpTimeout(e,a,t);a.onmessage=function(e){clearTimeout(p),t(e.data)},a.postMessage(["search",n,e])}},this.setAsyncFunctionPrototype(this.STRING,"search",t),t=function(e,t,n){var o=String(this);if(t=String(t),r.isa(e,r.REGEXP)&&(e=e.data,r.maybeThrowRegExp(e,n),2===r["REGEXP_MODE"]))if(Interpreter.vm){var i={string:o,substr:e,newSubstr:t},s="string.replace(substr, newSubstr)",a=r.vmCall(s,i,e,n);a!==Interpreter.REGEXP_TIMEOUT&&n(a)}else{var p=r.createWorker(),c=r.regExpTimeout(e,p,n);p.onmessage=function(e){clearTimeout(c),n(e.data)},p.postMessage(["replace",o,e,t])}else n(o.replace(e,t))},this.setAsyncFunctionPrototype(this.STRING,"replace",t),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},Interpreter.prototype.initBoolean=function(e){var t,r=this;t=function(e){return e=Boolean(e),r.calledWithNew()?(this.data=e,this):e},this.BOOLEAN=this.createNativeFunction(t,!0),this.setProperty(e,"Boolean",this.BOOLEAN)},Interpreter.prototype.initNumber=function(e){var t,r=this;t=function(e){return e=arguments.length?Number(e):0,r.calledWithNew()?(this.data=e,this):e},this.NUMBER=this.createNativeFunction(t,!0),this.setProperty(e,"Number",this.NUMBER);for(var n=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<n.length;o++)this.setProperty(this.NUMBER,n[o],Number[n[o]],Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR);t=function(e){try{return Number(this).toExponential(e)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",t),t=function(e){try{return Number(this).toFixed(e)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",t),t=function(e){try{return Number(this).toPrecision(e)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",t),t=function(e){try{return Number(this).toString(e)}catch(t){r.throwException(r.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",t),t=function(e,t){return e=e?r.pseudoToNative(e):void 0,t=t?r.pseudoToNative(t):void 0,Number(this).toLocaleString(e,t)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",t)},Interpreter.prototype.initDate=function(e){var t,r=this;t=function(e,t){if(!r.calledWithNew())return Date();var n=[null].concat(Array.from(arguments));return this.data=new(Function.prototype.bind.apply(Date,n)),this},this.DATE=this.createNativeFunction(t,!0),this.DATE_PROTO=this.DATE.properties["prototype"],this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),Interpreter.NONENUMERABLE_DESCRIPTOR);for(var n=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<n.length;o++)t=function(e){return function(t){for(var n=[],o=0;o<arguments.length;o++)n[o]=r.pseudoToNative(arguments[o]);return this.data[e].apply(this.data,n)}}(n[o]),this.setNativeFunctionPrototype(this.DATE,n[o],t)},Interpreter.prototype.initRegExp=function(e){var t,r=this;t=function(e,t){if(r.calledWithNew())var n=this;else n=r.createObjectProto(r.REGEXP_PROTO);return e=e?String(e):"",t=t?String(t):"",r.populateRegExp(n,new RegExp(e,t)),n},this.REGEXP=this.createNativeFunction(t,!0),this.REGEXP_PROTO=this.REGEXP.properties["prototype"],this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties["prototype"],"global",void 0,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties["prototype"],"ignoreCase",void 0,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties["prototype"],"multiline",void 0,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties["prototype"],"source","(?:)",Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("Object.defineProperty(RegExp.prototype, 'test',","{configurable: true, writable: true, value:","function(str) {","return String(str).search(this) !== -1","}","});"),t=function(e,t){var n=this.data;if(e=String(e),n.lastIndex=Number(r.getProperty(this,"lastIndex")),r.maybeThrowRegExp(n,t),2!==r["REGEXP_MODE"]){s=n.exec(e);r.setProperty(this,"lastIndex",n.lastIndex),t(u(s))}else if(Interpreter.vm){var o={string:e,regexp:n},i="regexp.exec(string)",s=r.vmCall(i,o,n,t);s!==Interpreter.REGEXP_TIMEOUT&&(r.setProperty(this,"lastIndex",n.lastIndex),t(u(s)))}else{var a=r.createWorker(),p=r.regExpTimeout(n,a,t),c=this;a.onmessage=function(e){clearTimeout(p),r.setProperty(c,"lastIndex",e.data[1]),t(u(e.data[0]))},a.postMessage(["exec",n,n.lastIndex,e])}function u(e){if(e){var t=r.arrayNativeToPseudo(e);return r.setProperty(t,"index",e.index),r.setProperty(t,"input",e.input),t}return null}},this.setAsyncFunctionPrototype(this.REGEXP,"exec",t)},Interpreter.prototype.initError=function(e){var t=this;this.ERROR=this.createNativeFunction((function(e){if(t.calledWithNew())var r=this;else r=t.createObject(t.ERROR);return e&&t.setProperty(r,"message",String(e),Interpreter.NONENUMERABLE_DESCRIPTOR),r}),!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties["prototype"],"message","",Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties["prototype"],"name","Error",Interpreter.NONENUMERABLE_DESCRIPTOR);var r=function(r){var n=t.createNativeFunction((function(e){if(t.calledWithNew())var r=this;else r=t.createObject(n);return e&&t.setProperty(r,"message",String(e),Interpreter.NONENUMERABLE_DESCRIPTOR),r}),!0);return t.setProperty(n,"prototype",t.createObject(t.ERROR),Interpreter.NONENUMERABLE_DESCRIPTOR),t.setProperty(n.properties["prototype"],"name",r,Interpreter.NONENUMERABLE_DESCRIPTOR),t.setProperty(e,r,n),n};this.EVAL_ERROR=r("EvalError"),this.RANGE_ERROR=r("RangeError"),this.REFERENCE_ERROR=r("ReferenceError"),this.SYNTAX_ERROR=r("SyntaxError"),this.TYPE_ERROR=r("TypeError"),this.URI_ERROR=r("URIError")},Interpreter.prototype.initMath=function(e){var t=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",t);for(var r=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],n=0;n<r.length;n++)this.setProperty(t,r[n],Math[r[n]],Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(n=0;n<o.length;n++)this.setProperty(t,o[n],this.createNativeFunction(Math[o[n]],!1),Interpreter.NONENUMERABLE_DESCRIPTOR)},Interpreter.prototype.initJSON=function(e){var t=this,r=t.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"JSON",r);var n=function(e){try{var r=JSON.parse(String(e))}catch(n){t.throwException(t.SYNTAX_ERROR,n.message)}return t.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(e,r,n){r&&"Function"===r.class?t.throwException(t.TYPE_ERROR,"Function replacer on JSON.stringify not supported"):r&&"Array"===r.class?(r=t.arrayPseudoToNative(r),r=r.filter((function(e){return"string"===typeof e||"number"===typeof e}))):r=null,"string"!==typeof n&&"number"!==typeof n&&(n=void 0);var o=t.pseudoToNative(e);try{var i=JSON.stringify(o,r,n)}catch(s){t.throwException(t.TYPE_ERROR,s.message)}return i},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},Interpreter.prototype.isa=function(e,t){if(null===e||void 0===e||!t)return!1;var r=t.properties["prototype"];if(e===r)return!0;e=this.getPrototype(e);while(e){if(e===r)return!0;e=e.proto}return!1},Interpreter.prototype.populateRegExp=function(e,t){e.data=new RegExp(t.source,t.flags),this.setProperty(e,"lastIndex",t.lastIndex,Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",t.source,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",t.global,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",t.ignoreCase,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",t.multiline,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR)},Interpreter.prototype.createWorker=function(){var e=this.createWorker.blob_;return e||(e=new Blob([Interpreter.WORKER_CODE.join("\n")],{type:"application/javascript"}),this.createWorker.blob_=e),new Worker(URL.createObjectURL(e))},Interpreter.prototype.vmCall=function(e,t,r,n){var o={timeout:this["REGEXP_THREAD_TIMEOUT"]};try{return Interpreter.vm["runInNewContext"](e,t,o)}catch(i){n(null),this.throwException(this.ERROR,"RegExp Timeout: "+r)}return Interpreter.REGEXP_TIMEOUT},Interpreter.prototype.maybeThrowRegExp=function(e,t){var r;if(0===this["REGEXP_MODE"])r=!1;else if(1===this["REGEXP_MODE"])r=!0;else if(Interpreter.vm)r=!0;else if("function"===typeof Worker&&"function"===typeof URL)r=!0;else if("function"===typeof require){try{Interpreter.vm=require("vm")}catch(n){}r=!!Interpreter.vm}else r=!1;r||(t(null),this.throwException(this.ERROR,"Regular expressions not supported: "+e))},Interpreter.prototype.regExpTimeout=function(e,t,r){var n=this;return setTimeout((function(){t.terminate(),r(null);try{n.throwException(n.ERROR,"RegExp Timeout: "+e)}catch(o){}}),this["REGEXP_THREAD_TIMEOUT"])},Interpreter.prototype.createObject=function(e){return this.createObjectProto(e&&e.properties["prototype"])},Interpreter.prototype.createObjectProto=function(e){if("object"!==typeof e)throw Error("Non object prototype");var t=new Interpreter.Object(e);return this.isa(t,this.ERROR)&&(t.class="Error"),t},Interpreter.prototype.createArray=function(){var e=this.createObjectProto(this.ARRAY_PROTO);return this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array",e},Interpreter.prototype.createFunctionBase_=function(e,t){var r=this.createObjectProto(this.FUNCTION_PROTO);if(t){var n=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(r,"prototype",n,Interpreter.NONENUMERABLE_DESCRIPTOR),this.setProperty(n,"constructor",r,Interpreter.NONENUMERABLE_DESCRIPTOR)}else r.illegalConstructor=!0;return this.setProperty(r,"length",e,Interpreter.READONLY_NONENUMERABLE_DESCRIPTOR),r.class="Function",r},Interpreter.prototype.createFunction=function(e,t){var r=this.createFunctionBase_(e["params"].length,!0);return r.parentScope=t,r.node=e,r},Interpreter.prototype.createNativeFunction=function(e,t){var r=this.createFunctionBase_(e.length,t);return r.nativeFunc=e,e.id=this.functionCounter_++,r},Interpreter.prototype.createAsyncFunction=function(e){var t=this.createFunctionBase_(e.length,!0);return t.asyncFunc=e,e.id=this.functionCounter_++,t},Interpreter.prototype.nativeToPseudo=function(e){if(e instanceof Interpreter.Object)throw Error("Object is already pseudo");if("object"!==typeof e&&"function"!==typeof e||null===e)return e;if(e instanceof RegExp){var t=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(t,e),t}if(e instanceof Date){var r=this.createObjectProto(this.DATE_PROTO);return r.data=new Date(e.valueOf()),r}if("function"===typeof e){var n=this,o=function(){var t=Array.prototype.slice.call(arguments).map((function(e){return n.pseudoToNative(e)})),r=e.apply(n,t);return n.nativeToPseudo(r)},i=Object.getOwnPropertyDescriptor(e,"prototype");return this.createNativeFunction(o,!!i)}if(Array.isArray(e)){for(var s=this.createArray(),a=0;a<e.length;a++)a in e&&this.setProperty(s,a,this.nativeToPseudo(e[a]));return s}var p=this.createObjectProto(this.OBJECT_PROTO);for(var c in e)this.setProperty(p,c,this.nativeToPseudo(e[c]));return p},Interpreter.prototype.pseudoToNative=function(e,t){if("object"!==typeof e&&"function"!==typeof e||null===e)return e;if(!(e instanceof Interpreter.Object))throw Error("Object is not pseudo");if(this.isa(e,this.REGEXP)){var r=new RegExp(e.data.source,e.data.flags);return r.lastIndex=e.data.lastIndex,r}if(this.isa(e,this.DATE))return new Date(e.data.valueOf());var n,o=t||{pseudo:[],native:[]},i=o.pseudo.indexOf(e);if(-1!==i)return o.native[i];if(o.pseudo.push(e),this.isa(e,this.ARRAY)){n=[],o.native.push(n);var s=this.getProperty(e,"length");for(i=0;i<s;i++)this.hasProperty(e,i)&&(n[i]=this.pseudoToNative(this.getProperty(e,i),o))}else{var a;for(var p in n={},o.native.push(n),e.properties)a=this.pseudoToNative(e.properties[p],o),Object.defineProperty(n,p,{value:a,writable:!0,enumerable:!0,configurable:!0})}return o.pseudo.pop(),o.native.pop(),n},Interpreter.prototype.arrayNativeToPseudo=function(e){for(var t=this.createArray(),r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++)this.setProperty(t,r[n],e[r[n]]);return t},Interpreter.prototype.arrayPseudoToNative=function(e){var t=[];for(var r in e.properties)t[r]=this.getProperty(e,r);return t.length=Interpreter.legalArrayLength(this.getProperty(e,"length"))||0,t},Interpreter.prototype.getPrototype=function(e){switch(typeof e){case"number":return this.NUMBER.properties["prototype"];case"boolean":return this.BOOLEAN.properties["prototype"];case"string":return this.STRING.properties["prototype"]}return e?e.proto:null},Interpreter.prototype.getProperty=function(e,t){if(this.getterStep_)throw Error("Getter not supported in that context");if(t=String(t),void 0!==e&&null!==e||this.throwException(this.TYPE_ERROR,"Cannot read property '"+t+"' of "+e),"object"===typeof e&&!(e instanceof Interpreter.Object))throw TypeError("Expecting native value or pseudo object");if("length"===t){if(this.isa(e,this.STRING))return String(e).length}else if(t.charCodeAt(0)<64&&this.isa(e,this.STRING)){var r=Interpreter.legalArrayIndex(t);if(!isNaN(r)&&r<String(e).length)return String(e)[r]}do{if(e.properties&&t in e.properties){var n=e.getter[t];return n?(this.getterStep_=!0,n):e.properties[t]}}while(e=this.getPrototype(e))},Interpreter.prototype.hasProperty=function(e,t){if(!(e instanceof Interpreter.Object))throw TypeError("Primitive data type has no properties");if(t=String(t),"length"===t&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var r=Interpreter.legalArrayIndex(t);if(!isNaN(r)&&r<String(e).length)return!0}do{if(e.properties&&t in e.properties)return!0}while(e=this.getPrototype(e));return!1},Interpreter.prototype.setProperty=function(e,t,r,n){if(this.setterStep_)throw Error("Setter not supported in that context");if(t=String(t),void 0!==e&&null!==e||this.throwException(this.TYPE_ERROR,"Cannot set property '"+t+"' of "+e),"object"===typeof e&&!(e instanceof Interpreter.Object))throw TypeError("Expecting native value or pseudo object");n&&("get"in n||"set"in n)&&("value"in n||"writable"in n)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e instanceof Interpreter.Object){if(this.isa(e,this.STRING)){var i=Interpreter.legalArrayIndex(t);if("length"===t||!isNaN(i)&&i<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+t+"' of String '"+e.data+"'"))}if("Array"===e.class){var s,a=e.properties.length;if("length"===t){if(n){if(!("value"in n))return;r=n.value}if(r=Interpreter.legalArrayLength(r),isNaN(r)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),r<a)for(s in e.properties)s=Interpreter.legalArrayIndex(s),!isNaN(s)&&r<=s&&delete e.properties[s]}else isNaN(s=Interpreter.legalArrayIndex(t))||(e.properties.length=Math.max(a,s+1))}if(!e.preventExtensions||t in e.properties)if(n){"get"in n&&(n.get?e.getter[t]=n.get:delete e.getter[t]),"set"in n&&(n.set?e.setter[t]=n.set:delete e.setter[t]);var p={};"configurable"in n&&(p.configurable=n.configurable),"enumerable"in n&&(p.enumerable=n.enumerable),"writable"in n&&(p.writable=n.writable,delete e.getter[t],delete e.setter[t]),"value"in n?(p.value=n.value,delete e.getter[t],delete e.setter[t]):r!==Interpreter.VALUE_IN_DESCRIPTOR&&(p.value=r,delete e.getter[t],delete e.setter[t]);try{Object.defineProperty(e.properties,t,p)}catch(u){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+t)}}else{if(r===Interpreter.VALUE_IN_DESCRIPTOR)throw ReferenceError("Value not specified.");var c=e;while(!(t in c.properties))if(c=this.getPrototype(c),!c){c=e;break}if(c.setter&&c.setter[t])return this.setterStep_=!0,c.setter[t];if(c.getter&&c.getter[t])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+t+"' of object '"+e+"' which only has a getter");else try{e.properties[t]=r}catch(u){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+t+"' of object '"+e+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+t+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+t+"' on '"+e+"'")},Interpreter.prototype.setNativeFunctionPrototype=function(e,t,r){this.setProperty(e.properties["prototype"],t,this.createNativeFunction(r,!1),Interpreter.NONENUMERABLE_DESCRIPTOR)},Interpreter.prototype.setAsyncFunctionPrototype=function(e,t,r){this.setProperty(e.properties["prototype"],t,this.createAsyncFunction(r),Interpreter.NONENUMERABLE_DESCRIPTOR)},Interpreter.prototype.getScope=function(){var e=this.stateStack[this.stateStack.length-1].scope;if(!e)throw Error("No scope found.");return e},Interpreter.prototype.createScope=function(e,t){var r=!1;if(t&&t.strict)r=!0;else{var n=e["body"]&&e["body"][0];n&&n.expression&&"Literal"===n.expression["type"]&&"use strict"===n.expression.value&&(r=!0)}var o=this.createObjectProto(null),i=new Interpreter.Scope(t,r,o);return t||this.initGlobal(i.object),this.populateScope_(e,i),i},Interpreter.prototype.createSpecialScope=function(e,t){if(!e)throw Error("parentScope required");var r=t||this.createObjectProto(null);return new Interpreter.Scope(e,e.strict,r)},Interpreter.prototype.getValueFromScope=function(e){var t=this.getScope();while(t&&t!==this.globalScope){if(e in t.object.properties)return t.object.properties[e];t=t.parentScope}if(t===this.globalScope&&this.hasProperty(t.object,e))return this.getProperty(t.object,e);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r["type"]&&"typeof"===r["operator"]||this.throwException(this.REFERENCE_ERROR,e+" is not defined")},Interpreter.prototype.setValueToScope=function(e,t){var r=this.getScope(),n=r.strict;while(r&&r!==this.globalScope){if(e in r.object.properties)return void(r.object.properties[e]=t);r=r.parentScope}if(r===this.globalScope&&(!n||this.hasProperty(r.object,e)))return this.setProperty(r.object,e,t);this.throwException(this.REFERENCE_ERROR,e+" is not defined")},Interpreter.prototype.populateScope_=function(e,t){if("VariableDeclaration"===e["type"])for(var r=0;r<e["declarations"].length;r++)this.setProperty(t.object,e["declarations"][r]["id"]["name"],void 0,Interpreter.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e["type"])return void this.setProperty(t.object,e["id"]["name"],this.createFunction(e,t),Interpreter.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e["type"])return;if("ExpressionStatement"===e["type"])return}var n=e["constructor"];for(var o in e){var i=e[o];if(i&&"object"===typeof i)if(Array.isArray(i))for(r=0;r<i.length;r++)i[r]&&i[r].constructor===n&&this.populateScope_(i[r],t);else i.constructor===n&&this.populateScope_(i,t)}},Interpreter.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},Interpreter.prototype.getValue=function(e){return e[0]===Interpreter.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},Interpreter.prototype.setValue=function(e,t){return e[0]===Interpreter.SCOPE_REFERENCE?this.setValueToScope(e[1],t):this.setProperty(e[0],e[1],t)},Interpreter.prototype.throwException=function(e,t){if(void 0===t)var r=e;else{r=this.createObject(e);this.setProperty(r,"message",t,Interpreter.NONENUMERABLE_DESCRIPTOR)}throw this.unwind(Interpreter.Completion.THROW,r,void 0),Interpreter.STEP_ERROR},Interpreter.prototype.unwind=function(e,t,r){if(e===Interpreter.Completion.NORMAL)throw TypeError("Should not unwind for NORMAL completions");e:for(var n=this.stateStack;n.length>0;n.pop()){var o=n[n.length-1];switch(o.node["type"]){case"TryStatement":return void(o.cv={type:e,value:t,label:r});case"CallExpression":case"NewExpression":if(e===Interpreter.Completion.RETURN)return void(o.value=t);if(e!==Interpreter.Completion.THROW)throw Error("Unsynatctic break/continue not rejected by Acorn");break;case"Program":o.done=!0;break e}if(e===Interpreter.Completion.BREAK){if(r?o.labels&&-1!==o.labels.indexOf(r):o.isLoop||o.isSwitch)return void n.pop()}else if(e===Interpreter.Completion.CONTINUE&&(r?o.labels&&-1!==o.labels.indexOf(r):o.isLoop))return}var i;if(this.isa(t,this.ERROR)){var s={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},a=String(this.getProperty(t,"name")),p=this.getProperty(t,"message").valueOf(),c=s[a]||Error;i=c(p)}else i=String(t);throw i},Interpreter.prototype.createGetter_=function(e,t){if(!this.getterStep_)throw Error("Unexpected call to createGetter");this.getterStep_=!1;var r=Array.isArray(t)?t[0]:t,n=new this.nodeConstructor({options:{}});n["type"]="CallExpression";var o=new Interpreter.State(n,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=r,o.func_=e,o.doneArgs_=!0,o.arguments_=[],o},Interpreter.prototype.createSetter_=function(e,t,r){if(!this.setterStep_)throw Error("Unexpected call to createSetter");this.setterStep_=!1;var n=Array.isArray(t)?t[0]:this.globalObject,o=new this.nodeConstructor({options:{}});o["type"]="CallExpression";var i=new Interpreter.State(o,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=n,i.func_=e,i.doneArgs_=!0,i.arguments_=[r],i},Interpreter.Value,Interpreter.State=function(e,t){this.node=e,this.scope=t},Interpreter.Scope=function(e,t,r){this.parentScope=e,this.strict=t,this.object=r},Interpreter.Object=function(e){this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=e},Interpreter.Object.prototype.proto=null,Interpreter.Object.prototype.class="Object",Interpreter.Object.prototype.data=null,Interpreter.Object.prototype.toString=function(){if(!(this instanceof Interpreter.Object))return String(this);if("Array"===this.class){var e=Interpreter.toStringCycles_;e.push(this);try{for(var t=[],r=0;r<this.properties.length;r++){var n=this.properties[r];t[r]=n instanceof Interpreter.Object&&-1!==e.indexOf(n)?"...":n}}finally{e.pop()}return t.join(",")}if("Error"===this.class){var o,i;e=Interpreter.toStringCycles_;if(-1!==e.indexOf(this))return"[object Error]";var s=this;do{if("name"in s.properties){o=s.properties["name"];break}}while(s=s.proto);s=this;do{if("message"in s.properties){i=s.properties["message"];break}}while(s=s.proto);e.push(this);try{o=o&&String(o),i=i&&String(i)}finally{e.pop()}return i?o+": "+i:String(o)}return null!==this.data?String(this.data):"[object "+this.class+"]"},Interpreter.Object.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},Interpreter.prototype["stepArrayExpression"]=function(e,t,r){var n=r["elements"],o=t.n_||0;t.array_?(this.setProperty(t.array_,o,t.value),o++):(t.array_=this.createArray(),t.array_.properties.length=n.length);while(o<n.length){if(n[o])return t.n_=o,new Interpreter.State(n[o],t.scope);o++}e.pop(),e[e.length-1].value=t.array_},Interpreter.prototype["stepAssignmentExpression"]=function(e,t,r){if(!t.doneLeft_){t.doneLeft_=!0;var n=new Interpreter.State(r["left"],t.scope);return n.components=!0,n}if(!t.doneRight_){if(t.leftReference_||(t.leftReference_=t.value),t.doneGetter_&&(t.leftValue_=t.value),!t.doneGetter_&&"="!==r["operator"]){var o=this.getValue(t.leftReference_);if(t.leftValue_=o,this.getterStep_){t.doneGetter_=!0;var i=o;return this.createGetter_(i,t.leftReference_)}}return t.doneRight_=!0,new Interpreter.State(r["right"],t.scope)}if(t.doneSetter_)return e.pop(),void(e[e.length-1].value=t.setterValue_);var s=t.leftValue_,a=t.value;switch(r["operator"]){case"=":s=a;break;case"+=":s+=a;break;case"-=":s-=a;break;case"*=":s*=a;break;case"/=":s/=a;break;case"%=":s%=a;break;case"<<=":s<<=a;break;case">>=":s>>=a;break;case">>>=":s>>>=a;break;case"&=":s&=a;break;case"^=":s^=a;break;case"|=":s|=a;break;default:throw SyntaxError("Unknown assignment expression: "+r["operator"])}var p=this.setValue(t.leftReference_,s);if(p)return t.doneSetter_=!0,t.setterValue_=s,this.createSetter_(p,t.leftReference_,s);e.pop(),e[e.length-1].value=s},Interpreter.prototype["stepBinaryExpression"]=function(e,t,r){if(!t.doneLeft_)return t.doneLeft_=!0,new Interpreter.State(r["left"],t.scope);if(!t.doneRight_)return t.doneRight_=!0,t.leftValue_=t.value,new Interpreter.State(r["right"],t.scope);e.pop();var n,o=t.leftValue_,i=t.value;switch(r["operator"]){case"==":n=o==i;break;case"!=":n=o!=i;break;case"===":n=o===i;break;case"!==":n=o!==i;break;case">":n=o>i;break;case">=":n=o>=i;break;case"<":n=o<i;break;case"<=":n=o<=i;break;case"+":n=o+i;break;case"-":n=o-i;break;case"*":n=o*i;break;case"/":n=o/i;break;case"%":n=o%i;break;case"&":n=o&i;break;case"|":n=o|i;break;case"^":n=o^i;break;case"<<":n=o<<i;break;case">>":n=o>>i;break;case">>>":n=o>>>i;break;case"in":i instanceof Interpreter.Object||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+i+"'"),n=this.hasProperty(i,o);break;case"instanceof":this.isa(i,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=o instanceof Interpreter.Object&&this.isa(o,i);break;default:throw SyntaxError("Unknown binary operator: "+r["operator"])}e[e.length-1].value=n},Interpreter.prototype["stepBlockStatement"]=function(e,t,r){var n=t.n_||0,o=r["body"][n];if(o)return t.n_=n+1,new Interpreter.State(o,t.scope);e.pop()},Interpreter.prototype["stepBreakStatement"]=function(e,t,r){var n=r["label"]&&r["label"]["name"];this.unwind(Interpreter.Completion.BREAK,void 0,n)},Interpreter.prototype["stepCallExpression"]=function(e,t,r){if(!t.doneCallee_){t.doneCallee_=1;var n=new Interpreter.State(r["callee"],t.scope);return n.components=!0,n}if(1===t.doneCallee_){t.doneCallee_=2;var o=t.value;if(Array.isArray(o)){if(t.func_=this.getValue(o),o[0]===Interpreter.SCOPE_REFERENCE?t.directEval_="eval"===o[1]:t.funcThis_=o[0],o=t.func_,this.getterStep_)return t.doneCallee_=1,this.createGetter_(o,t.value)}else t.func_=o;t.arguments_=[],t.n_=0}o=t.func_;if(!t.doneArgs_){if(0!==t.n_&&t.arguments_.push(t.value),r["arguments"][t.n_])return new Interpreter.State(r["arguments"][t.n_++],t.scope);if("NewExpression"===r["type"]){if(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),o===this.ARRAY)t.funcThis_=this.createArray();else{var i=o.properties["prototype"];"object"===typeof i&&null!==i||(i=this.OBJECT_PROTO),t.funcThis_=this.createObjectProto(i)}t.isConstructor=!0}else void 0===t.funcThis_&&(t.funcThis_=t.scope.strict?void 0:this.globalObject);t.doneArgs_=!0}if(t.doneExec_)e.pop(),t.isConstructor&&"object"!==typeof t.value?e[e.length-1].value=t.funcThis_:e[e.length-1].value=t.value;else{t.doneExec_=!0,o instanceof Interpreter.Object||this.throwException(this.TYPE_ERROR,o+" is not a function");var s=o.node;if(s){for(var a=this.createScope(s["body"],o.parentScope),p=0;p<s["params"].length;p++){var c=s["params"][p]["name"],u=t.arguments_.length>p?t.arguments_[p]:void 0;this.setProperty(a.object,c,u)}var l=this.createArray();for(p=0;p<t.arguments_.length;p++)this.setProperty(l,p,t.arguments_[p]);this.setProperty(a.object,"arguments",l);var h=s["id"]&&s["id"]["name"];return h&&this.setProperty(a.object,h,o),this.setProperty(a.object,"this",t.funcThis_,Interpreter.READONLY_DESCRIPTOR),t.value=void 0,new Interpreter.State(s["body"],a)}if(o.eval){var f=t.arguments_[0];if("string"===typeof f){try{var E=acorn.parse(String(f),Interpreter.PARSE_OPTIONS)}catch(_){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+_.message)}var y=new this.nodeConstructor({options:{}});y["type"]="EvalProgram_",y["body"]=E["body"],Interpreter.stripLocations_(y,r["start"],r["end"]);a=t.directEval_?t.scope:this.globalScope;return a.strict?a=this.createScope(E,a):this.populateScope_(E,a),this.value=void 0,new Interpreter.State(y,a)}t.value=f}else if(o.nativeFunc)t.value=o.nativeFunc.apply(t.funcThis_,t.arguments_);else{if(o.asyncFunc){var R=this,v=function(e){t.value=e,R.paused_=!1},O=o.asyncFunc.length-1,d=t.arguments_.concat(new Array(O)).slice(0,O);return d.push(v),this.paused_=!0,void o.asyncFunc.apply(t.funcThis_,d)}this.throwException(this.TYPE_ERROR,o.class+" is not callable")}}},Interpreter.prototype["stepCatchClause"]=function(e,t,r){if(!t.done_){t.done_=!0;var n=this.createSpecialScope(t.scope);return this.setProperty(n.object,r["param"]["name"],t.throwValue),new Interpreter.State(r["body"],n)}e.pop()},Interpreter.prototype["stepConditionalExpression"]=function(e,t,r){var n=t.mode_||0;if(0===n)return t.mode_=1,new Interpreter.State(r["test"],t.scope);if(1===n){t.mode_=2;var o=Boolean(t.value);if(o&&r["consequent"])return new Interpreter.State(r["consequent"],t.scope);if(!o&&r["alternate"])return new Interpreter.State(r["alternate"],t.scope);this.value=void 0}e.pop(),"ConditionalExpression"===r["type"]&&(e[e.length-1].value=t.value)},Interpreter.prototype["stepContinueStatement"]=function(e,t,r){var n=r["label"]&&r["label"]["name"];this.unwind(Interpreter.Completion.CONTINUE,void 0,n)},Interpreter.prototype["stepDebuggerStatement"]=function(e,t,r){e.pop()},Interpreter.prototype["stepDoWhileStatement"]=function(e,t,r){if("DoWhileStatement"===r["type"]&&void 0===t.test_&&(t.value=!0,t.test_=!0),!t.test_)return t.test_=!0,new Interpreter.State(r["test"],t.scope);if(t.value){if(r["body"])return t.test_=!1,t.isLoop=!0,new Interpreter.State(r["body"],t.scope)}else e.pop()},Interpreter.prototype["stepEmptyStatement"]=function(e,t,r){e.pop()},Interpreter.prototype["stepEvalProgram_"]=function(e,t,r){var n=t.n_||0,o=r["body"][n];if(o)return t.n_=n+1,new Interpreter.State(o,t.scope);e.pop(),e[e.length-1].value=this.value},Interpreter.prototype["stepExpressionStatement"]=function(e,t,r){if(!t.done_)return t.done_=!0,new Interpreter.State(r["expression"],t.scope);e.pop(),this.value=t.value},Interpreter.prototype["stepForInStatement"]=function(e,t,r){if(!t.doneInit_&&(t.doneInit_=!0,r["left"]["declarations"]&&r["left"]["declarations"][0]["init"]))return t.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new Interpreter.State(r["left"],t.scope);if(!t.doneObject_)return t.doneObject_=!0,t.variable_||(t.variable_=t.value),new Interpreter.State(r["right"],t.scope);if(t.isLoop||(t.isLoop=!0,t.object_=t.value,t.visited_=Object.create(null)),void 0===t.name_)e:while(1){if(t.object_ instanceof Interpreter.Object){t.props_||(t.props_=Object.getOwnPropertyNames(t.object_.properties));while(1){var n=t.props_.shift();if(void 0===n)break;if(Object.prototype.hasOwnProperty.call(t.object_.properties,n)&&(!t.visited_[n]&&(t.visited_[n]=!0,Object.prototype.propertyIsEnumerable.call(t.object_.properties,n)))){t.name_=n;break e}}}else if(null!==t.object_&&void 0!==t.object_){t.props_||(t.props_=Object.getOwnPropertyNames(t.object_));while(1){n=t.props_.shift();if(void 0===n)break;if(t.visited_[n]=!0,Object.prototype.propertyIsEnumerable.call(t.object_,n)){t.name_=n;break e}}}if(t.object_=this.getPrototype(t.object_),t.props_=null,null===t.object_)return void e.pop()}if(!t.doneVariable_){t.doneVariable_=!0;var o=r["left"];if("VariableDeclaration"!==o["type"]){t.variable_=null;var i=new Interpreter.State(o,t.scope);return i.components=!0,i}t.variable_=[Interpreter.SCOPE_REFERENCE,o["declarations"][0]["id"]["name"]]}if(t.variable_||(t.variable_=t.value),!t.doneSetter_){t.doneSetter_=!0;var s=t.name_,a=this.setValue(t.variable_,s);if(a)return this.createSetter_(a,t.variable_,s)}return t.name_=void 0,t.doneVariable_=!1,t.doneSetter_=!1,r["body"]?new Interpreter.State(r["body"],t.scope):void 0},Interpreter.prototype["stepForStatement"]=function(e,t,r){var n=t.mode_||0;if(0===n){if(t.mode_=1,r["init"])return new Interpreter.State(r["init"],t.scope)}else if(1===n){if(t.mode_=2,r["test"])return new Interpreter.State(r["test"],t.scope)}else if(2===n){if(t.mode_=3,!r["test"]||t.value)return t.isLoop=!0,new Interpreter.State(r["body"],t.scope);e.pop()}else if(3===n&&(t.mode_=1,r["update"]))return new Interpreter.State(r["update"],t.scope)},Interpreter.prototype["stepFunctionDeclaration"]=function(e,t,r){e.pop()},Interpreter.prototype["stepFunctionExpression"]=function(e,t,r){e.pop(),e[e.length-1].value=this.createFunction(r,t.scope)},Interpreter.prototype["stepIdentifier"]=function(e,t,r){if(e.pop(),t.components)e[e.length-1].value=[Interpreter.SCOPE_REFERENCE,r["name"]];else{var n=this.getValueFromScope(r["name"]);if(this.getterStep_){var o=t.scope;while(!this.hasProperty(o,r["name"]))o=o.parentScope;var i=n;return this.createGetter_(i,this.globalObject)}e[e.length-1].value=n}},Interpreter.prototype["stepIfStatement"]=Interpreter.prototype["stepConditionalExpression"],Interpreter.prototype["stepLabeledStatement"]=function(e,t,r){e.pop();var n=t.labels||[];n.push(r["label"]["name"]);var o=new Interpreter.State(r["body"],t.scope);return o.labels=n,o},Interpreter.prototype["stepLiteral"]=function(e,t,r){e.pop();var n=r["value"];if(n instanceof RegExp){var o=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(o,n),n=o}e[e.length-1].value=n},Interpreter.prototype["stepLogicalExpression"]=function(e,t,r){if("&&"!==r["operator"]&&"||"!==r["operator"])throw SyntaxError("Unknown logical operator: "+r["operator"]);if(!t.doneLeft_)return t.doneLeft_=!0,new Interpreter.State(r["left"],t.scope);if(t.doneRight_)e.pop(),e[e.length-1].value=t.value;else{if(!("&&"===r["operator"]&&!t.value||"||"===r["operator"]&&t.value))return t.doneRight_=!0,new Interpreter.State(r["right"],t.scope);e.pop(),e[e.length-1].value=t.value}},Interpreter.prototype["stepMemberExpression"]=function(e,t,r){if(!t.doneObject_)return t.doneObject_=!0,new Interpreter.State(r["object"],t.scope);var n;if(r["computed"]){if(!t.doneProperty_)return t.object_=t.value,t.doneProperty_=!0,new Interpreter.State(r["property"],t.scope);n=t.value}else t.object_=t.value,n=r["property"]["name"];if(e.pop(),t.components)e[e.length-1].value=[t.object_,n];else{var o=this.getProperty(t.object_,n);if(this.getterStep_){var i=o;return this.createGetter_(i,t.object_)}e[e.length-1].value=o}},Interpreter.prototype["stepNewExpression"]=Interpreter.prototype["stepCallExpression"],Interpreter.prototype["stepObjectExpression"]=function(e,t,r){var n=t.n_||0,o=r["properties"][n];if(t.object_){var i=o["key"];if("Identifier"===i["type"])var s=i["name"];else{if("Literal"!==i["type"])throw SyntaxError("Unknown object structure: "+i["type"]);s=i["value"]}t.properties_[s]||(t.properties_[s]={}),t.properties_[s][o["kind"]]=t.value,t.n_=++n,o=r["properties"][n]}else t.object_=this.createObjectProto(this.OBJECT_PROTO),t.properties_=Object.create(null);if(o)return new Interpreter.State(o["value"],t.scope);for(var i in t.properties_){var a=t.properties_[i];if("get"in a||"set"in a){var p={configurable:!0,enumerable:!0,get:a["get"],set:a["set"]};this.setProperty(t.object_,i,Interpreter.VALUE_IN_DESCRIPTOR,p)}else this.setProperty(t.object_,i,a["init"])}e.pop(),e[e.length-1].value=t.object_},Interpreter.prototype["stepProgram"]=function(e,t,r){var n=r["body"].shift();if(n)return t.done=!1,new Interpreter.State(n,t.scope);t.done=!0},Interpreter.prototype["stepReturnStatement"]=function(e,t,r){if(r["argument"]&&!t.done_)return t.done_=!0,new Interpreter.State(r["argument"],t.scope);this.unwind(Interpreter.Completion.RETURN,t.value,void 0)},Interpreter.prototype["stepSequenceExpression"]=function(e,t,r){var n=t.n_||0,o=r["expressions"][n];if(o)return t.n_=n+1,new Interpreter.State(o,t.scope);e.pop(),e[e.length-1].value=t.value},Interpreter.prototype["stepSwitchStatement"]=function(e,t,r){if(!t.test_)return t.test_=1,new Interpreter.State(r["discriminant"],t.scope);1===t.test_&&(t.test_=2,t.switchValue_=t.value,t.defaultCase_=-1);while(1){var n=t.index_||0,o=r["cases"][n];if(t.matched_||!o||o["test"])if(o||t.matched_||-1===t.defaultCase_){if(!o)return void e.pop();if(!t.matched_&&!t.tested_&&o["test"])return t.tested_=!0,new Interpreter.State(o["test"],t.scope);if(t.matched_||t.value===t.switchValue_){t.matched_=!0;var i=t.n_||0;if(o["consequent"][i])return t.isSwitch=!0,t.n_=i+1,new Interpreter.State(o["consequent"][i],t.scope)}t.tested_=!1,t.n_=0,t.index_=n+1}else t.matched_=!0,t.index_=t.defaultCase_;else t.defaultCase_=n,t.index_=n+1}},Interpreter.prototype["stepThisExpression"]=function(e,t,r){e.pop(),e[e.length-1].value=this.getValueFromScope("this")},Interpreter.prototype["stepThrowStatement"]=function(e,t,r){if(!t.done_)return t.done_=!0,new Interpreter.State(r["argument"],t.scope);this.throwException(t.value)},Interpreter.prototype["stepTryStatement"]=function(e,t,r){if(!t.doneBlock_)return t.doneBlock_=!0,new Interpreter.State(r["block"],t.scope);if(t.cv&&t.cv.type===Interpreter.Completion.THROW&&!t.doneHandler_&&r["handler"]){t.doneHandler_=!0;var n=new Interpreter.State(r["handler"],t.scope);return n.throwValue=t.cv.value,t.cv=void 0,n}if(!t.doneFinalizer_&&r["finalizer"])return t.doneFinalizer_=!0,new Interpreter.State(r["finalizer"],t.scope);e.pop(),t.cv&&this.unwind(t.cv.type,t.cv.value,t.cv.label)},Interpreter.prototype["stepUnaryExpression"]=function(e,t,r){if(!t.done_){t.done_=!0;var n=new Interpreter.State(r["argument"],t.scope);return n.components="delete"===r["operator"],n}e.pop();var o=t.value;if("-"===r["operator"])o=-o;else if("+"===r["operator"])o=+o;else if("!"===r["operator"])o=!o;else if("~"===r["operator"])o=~o;else if("delete"===r["operator"]){var i=!0;if(Array.isArray(o)){var s=o[0];s===Interpreter.SCOPE_REFERENCE&&(s=t.scope);var a=String(o[1]);try{delete s.properties[a]}catch(p){t.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+a+"' of '"+s+"'"):i=!1}}o=i}else if("typeof"===r["operator"])o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==r["operator"])throw SyntaxError("Unknown unary operator: "+r["operator"]);o=void 0}e[e.length-1].value=o},Interpreter.prototype["stepUpdateExpression"]=function(e,t,r){if(!t.doneLeft_){t.doneLeft_=!0;var n=new Interpreter.State(r["argument"],t.scope);return n.components=!0,n}if(t.leftSide_||(t.leftSide_=t.value),t.doneGetter_&&(t.leftValue_=t.value),!t.doneGetter_){var o=this.getValue(t.leftSide_);if(t.leftValue_=o,this.getterStep_){t.doneGetter_=!0;var i=o;return this.createGetter_(i,t.leftSide_)}}if(t.doneSetter_)return e.pop(),void(e[e.length-1].value=t.setterValue_);var s;o=Number(t.leftValue_);if("++"===r["operator"])s=o+1;else{if("--"!==r["operator"])throw SyntaxError("Unknown update expression: "+r["operator"]);s=o-1}var a=r["prefix"]?s:o,p=this.setValue(t.leftSide_,s);if(p)return t.doneSetter_=!0,t.setterValue_=a,this.createSetter_(p,t.leftSide_,s);e.pop(),e[e.length-1].value=a},Interpreter.prototype["stepVariableDeclaration"]=function(e,t,r){var n=r["declarations"],o=t.n_||0,i=n[o];t.init_&&i&&(this.setValueToScope(i["id"]["name"],t.value),t.init_=!1,i=n[++o]);while(i){if(i["init"])return t.n_=o,t.init_=!0,new Interpreter.State(i["init"],t.scope);i=n[++o]}e.pop()},Interpreter.prototype["stepWithStatement"]=function(e,t,r){if(!t.doneObject_)return t.doneObject_=!0,new Interpreter.State(r["object"],t.scope);if(!t.doneBody_){t.doneBody_=!0;var n=this.createSpecialScope(t.scope,t.value);return new Interpreter.State(r["body"],n)}e.pop()},Interpreter.prototype["stepWhileStatement"]=Interpreter.prototype["stepDoWhileStatement"],this["Interpreter"]=Interpreter,Interpreter.prototype["step"]=Interpreter.prototype.step,Interpreter.prototype["run"]=Interpreter.prototype.run,Interpreter.prototype["appendCode"]=Interpreter.prototype.appendCode,Interpreter.prototype["createObject"]=Interpreter.prototype.createObject,Interpreter.prototype["createObjectProto"]=Interpreter.prototype.createObjectProto,Interpreter.prototype["createAsyncFunction"]=Interpreter.prototype.createAsyncFunction,Interpreter.prototype["createNativeFunction"]=Interpreter.prototype.createNativeFunction,Interpreter.prototype["getProperty"]=Interpreter.prototype.getProperty,Interpreter.prototype["setProperty"]=Interpreter.prototype.setProperty,Interpreter.prototype["nativeToPseudo"]=Interpreter.prototype.nativeToPseudo,Interpreter.prototype["pseudoToNative"]=Interpreter.prototype.pseudoToNative;