/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
"use strict";function deserialize(e,r){function t(e){if(e&&"object"===typeof e){var r;if(r=e["#"]){if(e=o[r],!e)throw ReferenceError("Object reference not found: "+r);return e}if(r=e["Number"])return Number(r);if((r=e["Value"])&&"undefined"===e["Value"])return}return e}var n=r.stateStack;if(!Array.isArray(e))throw TypeError("Top-level JSON is not a list.");if(!n.length)throw Error("Interpreter must be initialized prior to deserialization.");var o=[];objectHunt_(n,o);for(var a=Object.create(null),i=0;i<o.length;i++)"function"==typeof o[i]&&(a[o[i].id]=o[i]);o=[];for(i=0;i<e.length;i++){var c=e[i];switch(c["type"]){case"Map":p=Object.create(null);break;case"Object":p={};break;case"ScopeReference":p=Interpreter.SCOPE_REFERENCE;break;case"Function":if(p=a[c["id"]],!p)throw RangeError("Function ID not found: "+c["id"]);break;case"Array":p=[];break;case"Date":if(p=new Date(c["data"]),isNaN(p))throw TypeError("Invalid date: "+c["data"]);break;case"RegExp":p=RegExp(c["source"],c["flags"]);break;case"PseudoObject":p=new Interpreter.Object(null);break;case"Scope":p=new Interpreter.Scope(void 0,void 0,void 0);break;case"State":p=new Interpreter.State(void 0,void 0);break;case"Node":p=new r.nodeConstructor;break;default:throw TypeError("Unknown type: "+c["type"])}o[i]=p}for(i=0;i<e.length;i++){c=e[i];var p=o[i],u=c["props"];if(u)for(var f=c["nonConfigurable"]||[],b=c["nonEnumerable"]||[],l=c["nonWritable"]||[],s=Object.getOwnPropertyNames(u),O=0;O<s.length;O++){var y=s[O];Object.defineProperty(p,y,{configurable:-1===f.indexOf(y),enumerable:-1===b.indexOf(y),writable:-1===l.indexOf(y),value:t(u[y])})}if(Array.isArray(p)){var R=c["data"];if(R)for(O=0;O<R.length;O++)p.push(t(R[O]))}}var E=o[0];for(var d in E)r[d]=E[d]}function serialize(e){function r(e){if(e&&("object"===typeof e||"function"===typeof e)){var r=a.indexOf(e);if(-1===r)throw RangeError("Object not found in table.");return{"#":r}}if(void 0===e)return{Value:"undefined"};if("number"===typeof e){if(e===1/0)return{Number:"Infinity"};if(e===-1/0)return{Number:"-Infinity"};if(isNaN(e))return{Number:"NaN"};if(1/e===-1/0)return{Number:"-0"}}return e}for(var t=["OBJECT","OBJECT_PROTO","FUNCTION","FUNCTION_PROTO","ARRAY","ARRAY_PROTO","REGEXP","REGEXP_PROTO","BOOLEAN","DATE","NUMBER","STRING","ERROR","EVAL_ERROR","RANGE_ERROR","REFERENCE_ERROR","SYNTAX_ERROR","TYPE_ERROR","URI_ERROR","globalScope","globalObject","stateStack"],n=Object.create(null),o=0;o<t.length;o++)n[t[o]]=e[t[o]];var a=[];objectHunt_(n,a);var i=[];for(o=0;o<a.length;o++){var c=Object.create(null);i.push(c);var p=a[o];switch(Object.getPrototypeOf(p)){case null:c["type"]="Map";break;case Object.prototype:if(p===Interpreter.SCOPE_REFERENCE){c["type"]="ScopeReference";continue}c["type"]="Object";break;case Function.prototype:if(c["type"]="Function",c["id"]=p.id,void 0===p.id)throw Error("Native function has no ID: "+p);continue;case Array.prototype:c["type"]="Array",p.length&&(c["data"]=p.map(r));continue;case Date.prototype:c["type"]="Date",c["data"]=p.toJSON();continue;case RegExp.prototype:c["type"]="RegExp",c["source"]=p.source,c["flags"]=p.flags;continue;case Interpreter.Object.prototype:c["type"]="PseudoObject";break;case Interpreter.Scope.prototype:c["type"]="Scope";break;case Interpreter.State.prototype:c["type"]="State";break;case e.nodeConstructor.prototype:c["type"]="Node";break;default:throw TypeError("Unknown type: "+p)}for(var u=Object.create(null),f=[],b=[],l=[],s=Object.getOwnPropertyNames(p),O=0;O<s.length;O++){var y=s[O];u[y]=r(p[y]);var R=Object.getOwnPropertyDescriptor(p,y);R.configurable||f.push(y),R.enumerable||b.push(y),R.writable||l.push(y)}s.length&&(c["props"]=u),f.length&&(c["nonConfigurable"]=f),b.length&&(c["nonEnumerable"]=b),l.length&&(c["nonWritable"]=l)}return i}function objectHunt_(e,r){if(e&&("object"===typeof e||"function"===typeof e)){if(-1!=r.indexOf(e))return;if(r.push(e),"object"===typeof e)for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++)objectHunt_(e[t[n]],r)}}